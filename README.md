# 视频文字编辑器

## 项目介绍
视频文字编辑器是一个基于Web的应用程序，可以在视频上添加打字机效果文字和静态文字，适用于制作宣传视频、教学视频等多种场景。

## 功能特性
- 支持打字机效果文字显示
- 支持多行静态文字叠加
- 支持多种视频模板选择
- 自动循环播放短视频
- 支持视频合成次数统计
- 支持Docker容器化部署

## 安装部署

### 本地部署
1. 确保系统已安装Python 3.7或以上版本
2. 克隆项目到本地
3. 确保系统已安装以下依赖：
   - Python包：moviepy、flask、pillow
   - 系统依赖：ffmpeg
4. 安装依赖包：
   ```bash
   pip install -r requirements.txt
   ```
5. 运行应用：
   ```bash
   python app.py
   ```
6. 访问 http://localhost:5000 开始使用

### Docker部署
1. 确保已安装Docker和Docker Compose
2. 拉取Docker镜像：
   ```bash
   docker pull catchoco/video_demo:v1.0
   ```
3. 在项目根目录下运行：
   ```bash
   docker-compose up -d
   ```
4. 访问 http://localhost:5000 开始使用

## 视频模板规则

### 模板存放
- 所有视频模板文件必须存放在 `asset/video` 目录下
- 支持的视频格式：MP4、AVI、MOV
- 视频文件名将作为模板ID使用

### 模板要求
- 建议使用16:9或4:3比例的视频
- 视频时长建议在10-60秒之间
- 视频背景应该适合叠加文字（避免过于复杂的背景）

## 视频生成规则

### 文字设置
- 店名：显示在视频顶部标题图片中央，字号48px，黑色
- 底部评论：显示在视频底部评论背景图上，位置(60, 1080)，字号30px，黑色，带打字机效果
- 好外卖分部：显示在底部评论下方，位置(590, 1240)，字号62px，红色
- 左侧评论：显示在左侧五星图片下方，位置(55, 410)，字号30px，黑色
- 右侧评论：显示在右侧评论背景上，位置(630, 660)，字号36px，黑色，5度倾斜，3px描边
- 字数统计：显示在右侧评论上方，位置(633, 505)，字号55px，白色，5度倾斜，8px描边

### 输出规则
- 所有生成的视频文件将保存在 `output` 目录下
- 输出文件名格式：video_模板ID_时间戳_随机数.mp4
- 如果打字机效果文字显示时间超过原视频时长，视频将自动循环播放

## 缓存清理
- 建议定期清理 `output` 目录下的历史视频文件
- 可以使用项目提供的 `clean_videos.py` 脚本清理过期视频：
  ```bash
  python clean_videos.py
  ```

## 注意事项
1. 确保系统已安装Python 3.7或以上版本
2. 确保有足够的磁盘空间用于存储生成的视频
3. 不要手动删除或修改data目录下的计数文件
4. 建议定期备份重要的视频模板文件
5. Docker部署时注意映射好视频模板目录和输出目录

## 技术支持
如遇到问题，请检查以下几点：
1. 确认所有依赖包已正确安装
2. 检查视频模板文件格式是否正确
3. 确认系统有足够的磁盘空间
4. 查看应用日志了解详细错误信息

## 日志系统
- 日志文件存放在 `src/log` 目录下，按年月组织目录结构
- 日志文件按天分割，格式为 `video_editor_DD.log`
- 日志级别：
  - DEBUG：详细的调试信息
  - INFO：常规操作信息
  - WARNING：警告信息
  - ERROR：错误信息
  - CRITICAL：严重错误信息

## 性能优化
- 视频渲染使用多线程编码
- 使用 `faster` 编码预设提升渲染速度
- 设置合理的视频比特率（2000k）平衡质量和性能
- 建议定期清理日志文件和输出目录